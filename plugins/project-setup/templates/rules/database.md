---
paths:
  - "src/db/**"
  - "prisma/**"
  - "drizzle/**"
  - "src/models/**"
  - "src/repositories/**"
---

# 데이터베이스 규칙

## ORM 사용 원칙

<!-- TODO: 프로젝트 ORM에 맞게 채우기 (Prisma / Drizzle / Mongoose / TypeORM) -->
- ORM 생성 타입 재사용 우선 (직접 타입 정의 최소화)
- raw query 최소화, 불가피하면 파라미터 바인딩 필수
- 문자열 연결로 쿼리 생성 절대 금지

## 마이그레이션

- 스키마 변경은 반드시 마이그레이션 파일을 통해 진행
- 마이그레이션 파일에 롤백 로직 포함
- 프로덕션 DB에 직접 쿼리 실행 금지

## 테스트 DB

- 테스트는 전용 테스트 DB 사용 (프로덕션 DB 접근 금지)
- 테스트 간 DB 상태 독립 보장 (setup/teardown)

## 커넥션 관리

- 커넥션 풀 설정 확인 (서버리스 환경 시 주의)
- DB 커넥션 누수 방지 (try/finally 패턴)

## 스키마 변경 주의

- DB 스키마 변경은 리팩토링 범위 밖 → 별도 PR 필수
- 기존 데이터와의 호환성 확인 (마이그레이션 + 시드 데이터)
